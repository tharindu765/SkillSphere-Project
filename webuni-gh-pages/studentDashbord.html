<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillSphere - Student Dashboard</title>
    <style>
        :root {
            --primary-color: #ff6b6b;
            --primary-light: #ffebeb;
            --secondary-color: #ffffff;
            --text-color: #333333;
            --border-color: #f0f0f0;
            --success-color: #4caf50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--text-color);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: var(--secondary-color);
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 40px;
            text-align: center;
        }

        .nav-item {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }

        .nav-item.active {
            background-color: var(--primary-light);
            color: var(--primary-color);
            font-weight: 500;
        }

        .nav-item:hover {
            background-color: var(--primary-light);
        }

        .nav-item i {
            margin-right: 10px;
        }

        .main-content {
            flex: 1;
            padding: 30px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .greeting {
            font-size: 24px;
            font-weight: 500;
        }

        .profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .profile-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--secondary-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .stat-title {
            font-size: 14px;
            color: #777;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .courses {
            background-color: var(--secondary-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }

        .course-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .course-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .course-thumbnail {
            height: 140px;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-weight: bold;
        }

        .course-info {
            padding: 15px;
        }

        .course-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .course-instructor {
            font-size: 14px;
            color: #777;
            margin-bottom: 12px;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 65%;
        }

        .progress-text {
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }

        .view-all {
            color: var(--primary-color);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .search-bar {
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            width: 300px;
            border: 1px solid var(--border-color);
        }

        .search-bar input {
            border: none;
            outline: none;
            background: transparent;
            font-size: 14px;
            flex: 1;
        }

        .search-bar i {
            color: #777;
            margin-right: 10px;
        }

        .certificate-badge {
            display: inline-block;
            background-color: var(--primary-light);
            color: var(--primary-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 10px;
        }

        @media (max-width: 990px) {
            .course-list {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 15px;
            }

            .logo {
                margin-bottom: 20px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>
<body>
<div class="container">
    <div class="sidebar">
        <div class="logo">SkillSphere</div>
        <div class="nav-item active">
            <i class="fas fa-home"></i>
            Dashboard
        </div>
        <div class="nav-item">
            <i class="fas fa-book"></i>
            My Courses
        </div>
        <div class="nav-item">
            <i class="fas fa-certificate"></i>
            Certificates
        </div>
        <div class="nav-item">
            <i class="fas fa-store"></i>
            Course Marketplace
        </div>
        <div class="nav-item">
            <i class="fas fa-bell"></i>
            Notifications
        </div>
        <div class="nav-item">
            <i class="fas fa-cog"></i>
            Settings
        </div>
    </div>
    <div class="main-content">
        <div class="header">
            <div class="greeting">Welcome back, John!</div>
            <div class="profile">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search for courses...">
                </div>
                <div class="profile-img">J</div>
            </div>
        </div>
        <div class="stats">
            <div class="stat-card">
                <div class="stat-title">Enrolled Courses</div>
                <div class="stat-value">4</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Overall Progress</div>
                <div class="stat-value">65%</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Certificates Earned</div>
                <div class="stat-value">2</div>
            </div>
        </div>
        <div class="courses">
            <div class="section-title">
                My Courses
                <span class="view-all">View All</span>
            </div>
            <div class="course-list">
                <div class="course-card">
                    <div class="course-thumbnail">Web Development</div>
                    <div class="course-info">
                        <div class="course-title">Front-End Web Development</div>
                        <div class="course-instructor">By Sarah Johnson</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 75%"></div>
                        </div>
                        <div class="progress-text">
                            <span>Progress: 75%</span>
                            <span>12/16 Chapters</span>
                        </div>
                    </div>
                </div>
                <div class="course-card">
                    <div class="course-thumbnail">Data Science</div>
                    <div class="course-info">
                        <div class="course-title">Introduction to Data Science</div>
                        <div class="course-instructor">By Michael Chen</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%"></div>
                        </div>
                        <div class="progress-text">
                            <span>Progress: 100%</span>
                            <span>20/20 Chapters</span>
                        </div>
                        <div class="certificate-badge">Certificate Earned</div>
                    </div>
                </div>
                <div class="course-card">
                    <div class="course-thumbnail">UI/UX Design</div>
                    <div class="course-info">
                        <div class="course-title">UI/UX Design Fundamentals</div>
                        <div class="course-instructor">By Emily Rodriguez</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 45%"></div>
                        </div>
                        <div class="progress-text">
                            <span>Progress: 45%</span>
                            <span>9/20 Chapters</span>
                        </div>
                    </div>
                </div>
                <div class="course-card">
                    <div class="course-thumbnail">Marketing</div>
                    <div class="course-info">
                        <div class="course-title">Digital Marketing Strategies</div>
                        <div class="course-instructor">By Robert Kim</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%"></div>
                        </div>
                        <div class="progress-text">
                            <span>Progress: 100%</span>
                            <span>15/15 Chapters</span>
                        </div>
                        <div class="certificate-badge">Certificate Earned</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const API_BASE_URL = 'http://localhost:8080/api/v1';
    const studentId = localStorage.getItem("userId"); // Automatically get from storage
    let currentStudent = studentId;

    // ✅ Helper: Get Authorization headers
    function getAuthHeaders() {
        const token = localStorage.getItem("token");
        return {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
        };
    }

    document.addEventListener('DOMContentLoaded', function () {


        loadStudentData(studentId);

        document.querySelector('.view-all').addEventListener('click', function () {
            window.location.href = '/courses.html';
        });

        const searchInput = document.querySelector('.search-bar input');
        searchInput.addEventListener('keyup', function (event) {
            if (event.key === 'Enter') {
                searchCourses(this.value);
            }
        });
    });

    async function loadStudentData(studentId) {
        try {
            const studentData = await fetchStudentDetails(studentId);
            currentStudent = studentData;

           document.querySelector('.greeting').textContent = `Welcome back, ${studentData.fullName}!`;
            document.querySelector('.profile-img').textContent = studentData.fullName.charAt(0);

            const courses = await fetchEnrolledCourses(studentId);
            renderCourses(courses);

            updateStatistics(studentId);
        } catch (error) {
            console.error('Error loading student data:', error);
            showErrorMessage('Failed to load student data. Please try again later.');
        }
    }

    async function fetchStudentDetails(studentId) {
        const response = await fetch(`${API_BASE_URL}/students/${studentId}`, {
            headers: getAuthHeaders()
        });
        if (response.status === 401 || response.status === 403) {
            handleUnauthorized();
        }
        if (!response.ok) throw new Error(`Failed to fetch student details: ${response.status}`);
        return await response.json();
    }

    async function fetchEnrolledCourses(studentId) {
        const response = await fetch(`${API_BASE_URL}/students/${studentId}/courses`, {
            headers: getAuthHeaders()
        });
        if (response.status === 401 || response.status === 403) {
            handleUnauthorized();
        }
        if (!response.ok) throw new Error(`Failed to fetch enrolled courses: ${response.status}`);
        return await response.json();
    }

    async function updateStatistics(studentId) {
        try {
            const progressResponse = await fetch(`${API_BASE_URL}/students/${studentId}/progress`, {
                headers: getAuthHeaders()
            });
            if (progressResponse.status === 401 || progressResponse.status === 403) {
                handleUnauthorized();
            }
            if (progressResponse.ok) {
                const progress = await progressResponse.json();
                document.querySelector('.stat-card:nth-child(2) .stat-value').textContent = `${Math.round(progress)}%`;
            }

            const certificatesResponse = await fetch(`${API_BASE_URL}/students/${studentId}/certificates`, {
                headers: getAuthHeaders()
            });
            if (certificatesResponse.status === 401 || certificatesResponse.status === 403) {
                handleUnauthorized();
            }
            if (certificatesResponse.ok) {
                const certificates = await certificatesResponse.json();
                document.querySelector('.stat-card:nth-child(3) .stat-value').textContent = certificates;
            }
        } catch (error) {
            console.error('Error updating statistics:', error);
        }
    }

    function renderCourses(courses) {
        const courseList = document.querySelector('.course-list');
        courseList.innerHTML = '';

        document.querySelector('.stat-card:nth-child(1) .stat-value').textContent = courses.length;

        if (courses.length === 0) {
            courseList.innerHTML = '<p>No courses enrolled yet. Browse the course marketplace to get started!</p>';
            return;
        }

        courses.forEach(course => {
            const courseCard = createCourseCard(course);
            courseList.appendChild(courseCard);
        });
    }

    function createCourseCard(course) {
        const courseCard = document.createElement('div');
        courseCard.className = 'course-card';

        const progressPercentage = Math.round((course.completedChapters / course.totalChapters) * 100);
        const isCompleted = progressPercentage === 100;

        courseCard.innerHTML = `
            <div class="course-thumbnail">${course.category || 'Course'}</div>
            <div class="course-info">
                <div class="course-title">${course.title}</div>
                <div class="course-instructor">By ${course.instructorName}</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                </div>
                <div class="progress-text">
                    <span>Progress: ${progressPercentage}%</span>
                    <span>${course.completedChapters}/${course.totalChapters} Chapters</span>
                </div>
                ${isCompleted ? '<div class="certificate-badge">Certificate Earned</div>' : ''}
            </div>
        `;

        courseCard.addEventListener('click', function () {
            window.location.href = `/course-details.html?id=${course.id}`;
        });

        return courseCard;
    }

    function searchCourses(query) {
        if (!query.trim()) return;
        alert(`Searching for: ${query}`);
    }

    async function enrollInCourse(courseId) {
        if (!currentStudent) {
            showErrorMessage('You must be logged in to enroll in courses');
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/students/${currentStudent.id}/courses/${courseId}/enroll`, {
                method: 'POST',
                headers: getAuthHeaders()
            });
            if (response.status === 401 || response.status === 403) {
                handleUnauthorized();
            }
            if (response.ok) {
                showSuccessMessage('Successfully enrolled in course!');
                loadStudentData(currentStudent.id);
            } else {
                throw new Error('Enrollment failed');
            }
        } catch (error) {
            console.error('Error enrolling in course:', error);
            showErrorMessage('Failed to enroll in course. Please try again.');
        }
    }

    function showSuccessMessage(message) {
        alert(message);
    }

    function showErrorMessage(message) {
        alert('Error: ' + message);
    }

    function handleUnauthorized() {
        alert("Your session has expired. Please log in again.");
        window.location.href = "login.html";
    }

    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function () {
            const pageName = this.textContent.trim().toLowerCase().replace(/\s+/g, '-');
            if (!this.classList.contains('active')) {
                alert(`Navigating to: ${pageName}`);
                // In production: window.location.href = `/${pageName}.html`;
            }
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
      const navItems = document.querySelectorAll(".sidebar .nav-item");

      const navMap = {
        "Dashboard": "studentDashbord.html",
        "My Courses": "single-course.html",
        "Certificates": "certificates.html",
        "Course Marketplace": "marketplace.html",
        "Notifications": "notifications.html",
        "Settings": "settings.html"
      };

      navItems.forEach(item => {
        item.addEventListener("click", () => {
          const text = item.textContent.trim();
          const target = navMap[text];
          if (target) {
            window.location.href = target;
          } else {
            console.warn(`No page mapped for: ${text}`);
          }
        });
      });
    });
</script>

</body>
</html>